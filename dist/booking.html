<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Book an Outcome Guarantee Call — PermitPulse</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="canonical" href="https://getpermitpulse.com/booking.html">
  <script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"Organization",
  "name":"PermitPulse",
  "url":"https://getpermitpulse.com",
  "email":"hello@getpermitpulse.com",
  "potentialAction":{
    "@type":"ScheduleAction",
    "name":"Book an Outcome Guarantee intro call",
    "target":{
      "@type":"EntryPoint",
      "urlTemplate":"https://getpermitpulse.com/booking.html",
      "inLanguage":["en","es"],
      "actionPlatform":[
        "https://schema.org/DesktopWebPlatform",
        "https://schema.org/MobileWebPlatform"
      ]
    }
  }
}
  </script>
  <script>
    // Tailwind-ish utility—no build needed (updated to match new UI)
    const css = `
      :root {
        --bg:#020617;
        --card:#020617;
        --text:#e5e7eb;
        --muted:#9ca3af;
        --accent:#f97316;
        --ok:#22c55e;
        --border:#111827;
      }
      *{box-sizing:border-box}
      body{
        margin:0;
        font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
        background:radial-gradient(circle at top,#020617 0,#000 70%);
        color:var(--text);
        -webkit-font-smoothing:antialiased;
      }
      .wrap{max-width:640px;margin:0 auto;padding:20px 16px 32px}
      header{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:12px}
      .badgerow{display:flex;gap:8px;align-items:center}
      .badge{
        display:inline-flex;
        align-items:center;
        gap:6px;
        background:rgba(15,23,42,0.96);
        border:1px solid #1f2937;
        padding:6px 10px;
        border-radius:999px;
        font-size:12px;
        color:var(--muted);
      }
      .badge-dot{
        width:8px;height:8px;border-radius:999px;
        background:var(--ok);
        box-shadow:0 0 0 4px rgba(34,197,94,.2);
      }
      header h1{
        margin:4px 0 0;
        font-size:18px;
      }
      .muted{color:var(--muted);font-size:12px}
      .card{
        background:radial-gradient(circle at top left,#0f172a 0,#020617 55%);
        border:1px solid rgba(148,163,184,.22);
        border-radius:18px;
        padding:18px 16px 18px;
        box-shadow:0 18px 45px rgba(0,0,0,.65);
        margin-top:14px;
      }
      .row{display:grid;gap:12px}
      .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
      label{font-size:12px;color:var(--muted)}
      input,textarea,select,button{
        width:100%;
        padding:11px 13px;
        border-radius:12px;
        border:1px solid #1f2937;
        background:#020617;
        color:var(--text);
        font-size:14px;
      }
      input:focus,textarea:focus,select:focus{
        outline:2px solid #475569;
        outline-offset:1px;
      }
      .timegrid{display:flex;flex-wrap:wrap;gap:8px}
      .chip{
        padding:9px 11px;
        border:1px solid #334155;
        border-radius:999px;
        cursor:pointer;
        background:rgba(15,23,42,.96);
        font-size:13px;
      }
      .chip[aria-pressed="true"]{
        background:#1f2937;
        border-color:#64748b;
      }
      .btn{
        background:var(--accent);
        color:#0b1220;
        font-weight:700;
        border:none;
        cursor:pointer;
        border-radius:999px;
        padding:11px 16px;
        box-shadow:0 0 0 1px rgba(248,250,252,.15),
                   0 10px 30px rgba(248,113,22,.4);
      }
      .btn:disabled{opacity:.5;cursor:not-allowed}
      .success{
        background:rgba(34,197,94,.14);
        border:1px solid rgba(34,197,94,.4);
        padding:10px 11px;
        border-radius:12px;
        font-size:13px;
      }
      .err{
        background:rgba(244,63,94,.12);
        border:1px solid rgba(244,63,94,.35);
        padding:10px 11px;
        border-radius:12px;
        font-size:13px;
      }
    `;
    const style = document.createElement('style'); style.textContent = css; document.head.appendChild(style);
  </script>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="badgerow">
          <div class="badge">PermitPulse</div>
          <div class="badge">
            <span class="badge-dot"></span>
            <span id="ogBadge">Outcome Guarantee</span>
          </div>
        </div>
        <h1 id="title">Book an Outcome Guarantee intro call (15–30 min)</h1>
      </div>
    </header>

    <p class="muted" id="tzNote" style="margin-top:4px">
      Times shown are in <b>Pacific Time</b>.
    </p>
    <p class="muted" id="ogLine" style="margin-top:2px">
      Outcome Guarantee: <b>1–2 booked estimates</b> or full refund.
    </p>

    <div class="card">
      <div class="row2">
        <div>
          <label for="date"><span id="lblDate">Date</span></label>
          <input id="date" type="date" />
        </div>
        <div>
          <label><span id="lblTime">Time</span></label>
          <div id="times" class="timegrid" aria-live="polite"></div>
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <div class="row2">
          <div>
            <label for="name"><span id="lblName">Name</span></label>
            <input id="name" placeholder="Your name" autocomplete="name" />
          </div>
          <div>
            <label for="phone"><span id="lblPhone">Phone</span></label>
            <input id="phone" placeholder="(555) 555-5555" autocomplete="tel" />
          </div>
        </div>
        <div class="row2">
          <div>
            <label for="email"><span id="lblEmail">Email</span></label>
            <input id="email" type="email" placeholder="you@example.com" autocomplete="email" />
          </div>
          <div>
            <label for="lang"><span id="lblLang">Language</span></label>
            <select id="lang">
              <option value="en">English</option>
              <option value="es">Español (LA)</option>
            </select>
          </div>
        </div>
        <div>
          <label for="notes"><span id="lblNotes">Notes</span></label>
          <textarea id="notes" rows="3" placeholder="Anything we should know?"></textarea>
        </div>
        <button id="submit" class="btn">Book it</button>
        <div id="msg"></div>
      </div>
    </div>

    <p class="muted" id="helpText" style="margin-top:10px">
      Having trouble? Email <a href="mailto:hello@getpermitpulse.com">hello@getpermitpulse.com</a>
    </p>
  </div>

<script>
const API = '/book'; // adjust if mounted under subdir
const $ = sel => document.querySelector(sel);
const timesEl = $('#times');
const dateEl = $('#date');
const msgEl = $('#msg');
let chosenTime = null;
let currentLang = 'en';

const i18n = {
  en: {
    title: 'Book an Outcome Guarantee intro call (15–30 min)',
    tzNote: 'Times shown are in <b>Pacific Time</b>.',
    ogLine: 'Outcome Guarantee: <b>1–2 booked estimates</b> or full refund.',
    labels: { date:'Date', time:'Time', name:'Name', phone:'Phone', email:'Email', lang:'Language', notes:'Notes' },
    submit: 'Book it',
    helpHtml: 'Having trouble? Email <a href="mailto:hello@getpermitpulse.com">hello@getpermitpulse.com</a>',
    errors: { pickDateTime:'Pick a date and time.', enterName:'Enter your name.', enterEmail:'Enter your email.' },
    successPrefix: '<b>Booked!</b> Check your email/text. Add to calendar:',
    gcal: 'Google Calendar',
    ics: 'Download .ics',
    noTimes: 'No times available for this date.'
  },
  es: {
    title: 'Agenda una llamada (15–30 min) — Garantía de Resultados',
    tzNote: 'Los horarios se muestran en <b>Hora del Pacífico</b>.',
    ogLine: 'Garantía de Resultados: <b>1–2 estimados agendados</b> o reembolso total.',
    labels: { date:'Fecha', time:'Hora', name:'Nombre', phone:'Teléfono', email:'Correo', lang:'Idioma', notes:'Notas' },
    submit: 'Agendar',
    helpHtml: '¿Problemas? Escríbenos a <a href="mailto:hola@getpermitpulse.com">hola@getpermitpulse.com</a>',
    errors: { pickDateTime:'Elige fecha y hora.', enterName:'Escribe tu nombre.', enterEmail:'Escribe tu correo.' },
    successPrefix: '<b>¡Listo!</b> Revisa tu correo/SMS. Añádelo al calendario:',
    gcal: 'Google Calendar',
    ics: 'Descargar .ics',
    noTimes: 'No hay horarios disponibles para esta fecha.'
  }
};

function setLang(lang){
  currentLang = (lang === 'es') ? 'es' : 'en';
  const t = i18n[currentLang];
  $('#title').textContent = t.title;
  $('#tzNote').innerHTML = t.tzNote;
  $('#ogLine').innerHTML = t.ogLine;
  $('#lblDate').textContent = t.labels.date;
  $('#lblTime').textContent = t.labels.time;
  $('#lblName').textContent = t.labels.name;
  $('#lblPhone').textContent = t.labels.phone;
  $('#lblEmail').textContent = t.labels.email;
  $('#lblLang').textContent = t.labels.lang;
  $('#lblNotes').textContent = t.labels.notes;
  $('#submit').textContent = t.submit;
  $('#helpText').innerHTML = t.helpHtml;
}

function fmtDate(d){return d.toISOString().slice(0,10)}

function renderTimes(list){
  timesEl.innerHTML = '';
  const t = i18n[currentLang];
  if(!list || list.length===0){
    timesEl.innerHTML = `<span class="muted">${t.noTimes}</span>`;
    return;
  }
  list.forEach(time=>{
    const b = document.createElement('button');
    b.type = 'button'; b.className='chip'; b.textContent=time; b.setAttribute('aria-pressed', chosenTime===time?'true':'false');
    b.onclick=()=>{chosenTime=time; [...timesEl.children].forEach(c=>c.setAttribute('aria-pressed','false')); b.setAttribute('aria-pressed','true')};
    timesEl.appendChild(b);
  });
}

async function loadTimes(date){
  chosenTime=null;
  renderTimes([]);
  msg('');
  try{
    const r = await fetch(`${API}/slots?date=${date}`);
    const j = await r.json();
    renderTimes(j.slots||[]);
  }catch(e){
    renderTimes([]);
  }
}

function msg(html, ok=false){
  if(!html){ msgEl.innerHTML=''; return; }
  msgEl.innerHTML = `<div class="${ok?'success':'err'}">${html}</div>`;
}

async function book(){
  const t = i18n[currentLang];
  const body = {
    date: dateEl.value,
    time: chosenTime,
    name: $('#name').value.trim(),
    phone: $('#phone').value.trim(),
    email: $('#email').value.trim(),
    notes: $('#notes').value.trim(),
    lang: $('#lang').value
  };
  if(!body.date || !body.time) return msg(t.errors.pickDateTime);
  if(!body.name) return msg(t.errors.enterName);
  if(!body.email) return msg(t.errors.enterEmail);
  $('#submit').disabled=true;
  try{
    const r = await fetch(`${API}/book`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    const j = await r.json();
    if(!r.ok){ throw new Error(j.error||'Failed'); }
    msg(`${t.successPrefix} <a href="${j.gcalUrl}" target="_blank" rel="noopener">${t.gcal}</a> · <a href="${j.icsUrl}">${t.ics}</a>`, true);
    // GA4 conversion fires ONLY on confirmed booking
    try {
      if (typeof window.gtag === 'function') {
        gtag('event', 'booking_confirmed', {
          event_category: 'booking',
          slot: `${body.date || ''} ${body.time || ''}`,
          lang: body.lang || currentLang,
          value: 1
        });
      }
    } catch (_) {}
  }catch(e){
    msg(e.message||'Could not book. Slot may be taken.');
  }finally{
    $('#submit').disabled=false;
  }
}

// Init
(() => {
  const navEs = (navigator.language||'').toLowerCase().startsWith('es');
  if (navEs) { $('#lang').value='es'; }
  setLang($('#lang').value);
  const today = new Date();
  dateEl.value = fmtDate(today);
  loadTimes(dateEl.value);
  dateEl.addEventListener('change', ()=> loadTimes(dateEl.value));
  $('#submit').addEventListener('click', book);
  $('#lang').addEventListener('change', (e)=> setLang(e.target.value));
})();
</script>
</body>
</html>
