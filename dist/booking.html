<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Book an Outcome Guarantee Call — PermitPulse</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script>
    // Tiny Tailwind-ish utility—no build needed
    const css = `
      :root { --bg:#0b1220; --card:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#f97316; --ok:#22c55e; }
      *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
      .wrap{max-width:640px;margin:0 auto;padding:24px}
      .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
      .row{display:grid;gap:12px}
      .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
      label{font-size:12px;color:var(--muted)}
      input,textarea,select,button{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:var(--text)}
      input:focus,textarea:focus,select:focus{outline:2px solid #475569}
      .btn{background:var(--accent);color:#0b1220;font-weight:700;border:none;cursor:pointer}
      .btn:disabled{opacity:.5;cursor:not-allowed}
      .timegrid{display:flex;flex-wrap:wrap;gap:8px}
      .chip{padding:10px 12px;border:1px solid #334155;border-radius:10px;cursor:pointer}
      .chip[aria-pressed="true"]{background:#1f2937;border-color:#64748b}
      .muted{color:var(--muted);font-size:12px}
      .success{background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.35);padding:12px;border-radius:10px}
      .err{background:rgba(244,63,94,.12);border:1px solid rgba(244,63,94,.35);padding:12px;border-radius:10px}
      .badge{display:inline-block;background:#0b1220;border:1px solid #334155;padding:6px 10px;border-radius:999px;font-size:12px}
      header h1{margin:6px 0 0}
      .badgerow{display:flex;gap:8px;align-items:center}
    `;
    const style = document.createElement('style'); style.textContent = css; document.head.appendChild(style);
  </script>
</head>
<body>
  <div class="wrap">
    <header style="display:flex;align-items:center;gap:10px;">
      <div class="badgerow">
        <div class="badge">PermitPulse</div>
        <div class="badge" id="ogBadge">Outcome Guarantee</div>
      </div>
      <h1 id="title">Book an Outcome Guarantee intro call (15–30 min)</h1>
    </header>

    <p class="muted" id="tzNote" style="margin-top:6px">Times shown are in <b>Pacific Time</b>.</p>
    <p class="muted" id="ogLine" style="margin-top:2px">Outcome Guarantee: <b>1–2 booked estimates</b> or full refund.</p>

    <div class="card" style="margin-top:16px">
      <div class="row2">
        <div>
          <label for="date"><span id="lblDate">Date</span></label>
          <input id="date" type="date" />
        </div>
        <div>
          <label><span id="lblTime">Time</span></label>
          <div id="times" class="timegrid" aria-live="polite"></div>
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <div class="row2">
          <div>
            <label for="name"><span id="lblName">Name</span></label>
            <input id="name" placeholder="Your name" autocomplete="name" />
          </div>
          <div>
            <label for="phone"><span id="lblPhone">Phone</span></label>
            <input id="phone" placeholder="(555) 555-5555" autocomplete="tel" />
          </div>
        </div>
        <div class="row2">
          <div>
            <label for="email"><span id="lblEmail">Email</span></label>
            <input id="email" type="email" placeholder="you@example.com" autocomplete="email" />
          </div>
          <div>
            <label for="lang"><span id="lblLang">Language</span></label>
            <select id="lang">
              <option value="en">English</option>
              <option value="es">Español (LA)</option>
            </select>
          </div>
        </div>
        <div>
          <label for="notes"><span id="lblNotes">Notes</span></label>
          <textarea id="notes" rows="3" placeholder="Anything we should know?"></textarea>
        </div>
        <button id="submit" class="btn">Book it</button>
        <div id="msg"></div>
      </div>
    </div>

    <p class="muted" id="helpText" style="margin-top:10px">Having trouble? Email <a href="mailto:hello@getpermitpulse.com">hello@getpermitpulse.com</a></p>
  </div>

<script>
const API = '/book'; // adjust if mounted under subdir
const $ = sel => document.querySelector(sel);
const timesEl = $('#times');
const dateEl = $('#date');
const msgEl = $('#msg');
let chosenTime = null;
let currentLang = 'en';

const i18n = {
  en: {
    title: 'Book an Outcome Guarantee intro call (15–30 min)',
    tzNote: 'Times shown are in <b>Pacific Time</b>.',
    ogLine: 'Outcome Guarantee: <b>1–2 booked estimates</b> or full refund.',
    labels: { date:'Date', time:'Time', name:'Name', phone:'Phone', email:'Email', lang:'Language', notes:'Notes' },
    submit: 'Book it',
    helpHtml: 'Having trouble? Email <a href="mailto:hello@getpermitpulse.com">hello@getpermitpulse.com</a>',
    errors: { pickDateTime:'Pick a date and time.', enterName:'Enter your name.', enterEmail:'Enter your email.' },
    successPrefix: '<b>Booked!</b> Check your email/text. Add to calendar:',
    gcal: 'Google Calendar',
    ics: 'Download .ics',
    noTimes: 'No times available for this date.'
  },
  es: {
    title: 'Agenda una llamada (15–30 min) — Garantía de Resultados',
    tzNote: 'Los horarios se muestran en <b>Hora del Pacífico</b>.',
    ogLine: 'Garantía de Resultados: <b>1–2 estimados agendados</b> o reembolso total.',
    labels: { date:'Fecha', time:'Hora', name:'Nombre', phone:'Teléfono', email:'Correo', lang:'Idioma', notes:'Notas' },
    submit: 'Agendar',
    helpHtml: '¿Problemas? Escríbenos a <a href="mailto:hola@getpermitpulse.com">hola@getpermitpulse.com</a>',
    errors: { pickDateTime:'Elige fecha y hora.', enterName:'Escribe tu nombre.', enterEmail:'Escribe tu correo.' },
    successPrefix: '<b>¡Listo!</b> Revisa tu correo/SMS. Añádelo al calendario:',
    gcal: 'Google Calendar',
    ics: 'Descargar .ics',
    noTimes: 'No hay horarios disponibles para esta fecha.'
  }
};

function setLang(lang){
  currentLang = (lang === 'es') ? 'es' : 'en';
  const t = i18n[currentLang];
  $('#title').textContent = t.title;
  $('#tzNote').innerHTML = t.tzNote;
  $('#ogLine').innerHTML = t.ogLine;
  $('#lblDate').textContent = t.labels.date;
  $('#lblTime').textContent = t.labels.time;
  $('#lblName').textContent = t.labels.name;
  $('#lblPhone').textContent = t.labels.phone;
  $('#lblEmail').textContent = t.labels.email;
  $('#lblLang').textContent = t.labels.lang;
  $('#lblNotes').textContent = t.labels.notes;
  $('#submit').textContent = t.submit;
  $('#helpText').innerHTML = t.helpHtml;
}

function fmtDate(d){return d.toISOString().slice(0,10)}

function renderTimes(list){
  timesEl.innerHTML = '';
  const t = i18n[currentLang];
  if(!list || list.length===0){
    timesEl.innerHTML = `<span class="muted">${t.noTimes}</span>`;
    return;
  }
  list.forEach(time=>{
    const b = document.createElement('button');
    b.type = 'button'; b.className='chip'; b.textContent=time; b.setAttribute('aria-pressed', chosenTime===time?'true':'false');
    b.onclick=()=>{chosenTime=time; [...timesEl.children].forEach(c=>c.setAttribute('aria-pressed','false')); b.setAttribute('aria-pressed','true')};
    timesEl.appendChild(b);
  });
}

async function loadTimes(date){
  chosenTime=null;
  renderTimes([]);
  msg('');
  try{
    const r = await fetch(`${API}/slots?date=${date}`);
    const j = await r.json();
    renderTimes(j.slots||[]);
  }catch(e){
    renderTimes([]);
  }
}

function msg(html, ok=false){
  if(!html){ msgEl.innerHTML=''; return; }
  msgEl.innerHTML = `<div class="${ok?'success':'err'}">${html}</div>`;
}

async function book(){
  const t = i18n[currentLang];
  const body = {
    date: dateEl.value,
    time: chosenTime,
    name: $('#name').value.trim(),
    phone: $('#phone').value.trim(),
    email: $('#email').value.trim(),
    notes: $('#notes').value.trim(),
    lang: $('#lang').value
  };
  if(!body.date || !body.time) return msg(t.errors.pickDateTime);
  if(!body.name) return msg(t.errors.enterName);
  if(!body.email) return msg(t.errors.enterEmail);
  $('#submit').disabled=true;
  try{
    const r = await fetch(`${API}/book`, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
    const j = await r.json();
    if(!r.ok){ throw new Error(j.error||'Failed'); }
    msg(`${t.successPrefix} <a href="${j.gcalUrl}" target="_blank" rel="noopener">${t.gcal}</a> · <a href="${j.icsUrl}">${t.ics}</a>`, true);
  }catch(e){
    msg(e.message||'Could not book. Slot may be taken.');
  }finally{
    $('#submit').disabled=false;
  }
}

// Init
(() => {
  const navEs = (navigator.language||'').toLowerCase().startsWith('es');
  if (navEs) { $('#lang').value='es'; }
  setLang($('#lang').value);
  const today = new Date();
  dateEl.value = fmtDate(today);
  loadTimes(dateEl.value);
  dateEl.addEventListener('change', ()=> loadTimes(dateEl.value));
  $('#submit').addEventListener('click', book);
  $('#lang').addEventListener('change', (e)=> setLang(e.target.value));
})();
</script>
</body>
  </html>
