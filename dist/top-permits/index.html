<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PermitPulse | Top LA Permits Digest</title>
  <meta name="description" content="See the highest-value permits issued recently in Los Angeles. Free preview powered by LADBS open data." />

  <style>
    :root {
      --bg: #050505;
      --card-bg: #0f0f11;
      --card-border: #222;
      --text-main: #ededed;
      --text-muted: #888;
      --accent-orange: #ff4400;
      --accent-blue: #2952ff;
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      --font-mono: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: radial-gradient(circle at top, #050816 0%, #020617 40%, #020308 100%);
      color: var(--text-main);
      font-family: var(--font-sans);
      line-height: 1.4;
      min-height: 100vh;
    }

    a { color: inherit; text-decoration: none; }

    .wrap {
      width: 100%;
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 16px;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(10px);
      background: rgba(5, 5, 7, 0.85);
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
    }

    .nav-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 0;
      font-size: 14px;
    }

    .logo {
      font-weight: 700;
      letter-spacing: -0.03em;
    }

    .logo span { color: var(--accent-orange); }

    .nav-links {
      display: flex;
      gap: 18px;
    }

    .nav-links a {
      color: var(--text-muted);
      font-family: var(--font-mono);
      font-size: 12px;
    }

    .nav-links a.active {
      color: #fff;
      border-bottom: 1px solid var(--accent-orange);
      padding-bottom: 2px;
    }

    main {
      padding: 60px 0 80px;
    }

    h1 {
      font-size: clamp(2.1rem, 4vw, 3rem);
      letter-spacing: -0.04em;
      margin-bottom: 10px;
    }

    .kicker {
      font-family: var(--font-mono);
      letter-spacing: 0.16em;
      text-transform: uppercase;
      font-size: 11px;
      color: var(--accent-blue);
      margin-bottom: 10px;
    }

    .lead {
      color: var(--text-muted);
      max-width: 560px;
      font-size: 14px;
      margin-bottom: 24px;
    }

    .hero-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .pill {
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-family: var(--font-mono);
    }

    .layout {
      margin-top: 32px;
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(260px, 1fr);
      gap: 24px;
    }

    @media (max-width: 800px) {
      .layout { grid-template-columns: 1fr; }
    }

    .card {
      background: radial-gradient(circle at top left, rgba(15,23,42,0.9), rgba(3,7,18,0.98));
      border-radius: 18px;
      border: 1px solid var(--card-border);
      padding: 20px 20px 16px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.85);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }

    .card-header h2 {
      font-size: 18px;
      letter-spacing: -0.02em;
    }

    .status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
      font-family: var(--font-mono);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.9);
    }

    .filters {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 12px;
    }

    @media (max-width: 800px) {
      .filters { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    label {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
      display: inline-block;
    }

    select, input {
      width: 100%;
      background: #020617;
      border-radius: 8px;
      border: 1px solid #1e293b;
      padding: 7px 9px;
      font-size: 13px;
      color: #e5e7eb;
      font-family: var(--font-sans);
    }

    button {
      border: none;
      cursor: pointer;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-orange), #ec4899);
      border-radius: 999px;
      padding: 9px 16px;
      font-size: 13px;
      font-weight: 600;
      color: #020617;
      font-family: var(--font-sans);
      box-shadow: 0 10px 30px rgba(248, 113, 113, 0.45);
    }

    .table-wrap {
      margin-top: 8px;
      border-radius: 14px;
      border: 1px solid #1e293b;
      background: radial-gradient(circle at top, rgba(15,23,42,0.95), #020617);
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    thead {
      background: #020617;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 10px;
      color: #64748b;
    }

    thead th {
      text-align: left;
      padding: 8px 10px;
      border-bottom: 1px solid #1e293b;
      font-weight: 500;
    }

    tbody td {
      padding: 8px 10px;
      border-bottom: 1px solid rgba(15,23,42,0.85);
      vertical-align: top;
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    .val {
      color: var(--accent-orange);
      font-family: var(--font-mono);
      white-space: nowrap;
    }

    .muted {
      color: var(--text-muted);
    }

    .side-card {
      background: linear-gradient(145deg, #020617, #0b1120);
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.35);
      padding: 18px 18px 16px;
      font-size: 13px;
    }

    .side-badge {
      font-family: var(--font-mono);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--accent-blue);
      margin-bottom: 8px;
    }

    .side-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .side-list {
      margin-top: 10px;
      padding-left: 16px;
      color: var(--text-muted);
      font-size: 12px;
    }

    .side-list li { margin-bottom: 4px; }

    footer {
      padding-top: 30px;
      font-size: 11px;
      color: #64748b;
      border-top: 1px solid rgba(51,65,85,0.7);
      margin-top: 40px;
    }
  

.link{
  color: var(--accent-blue, #2952ff);
  text-decoration: underline;
  text-underline-offset: 3px;
}
.link:hover{
  color: var(--accent-orange, #ff4400);
}

</style>
</head>
<body>
  <header>
    <div class="wrap nav-inner">
      <div class="logo">PermitPulse <span>/</span> Top Permits</div>
      <nav class="nav-links">
        <a href="/radar/">Radar</a>
        <a href="/top-permits/" class="active">Top permits</a>
        <a href="/loi/">LOI tool</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <div>
      <div class="kicker">Top permits · LADBS feed</div>
      <h1>Highest-value jobs in LA, this month.</h1>
      <p class="lead">
        Free preview of the biggest permits just issued in the City of Los Angeles. Sort by trade and minimum value so you can see where the real money is moving.
      </p>
      <div class="hero-meta">
        <div class="pill">Dataset: LADBS “Building Permits Issued from 2020 to Present”</div>
        <div class="pill">Updated multiple times per day</div>
      </div>
    </div>

    <div class="layout">
      <!-- MAIN CARD -->
      <section class="card">
        <div class="card-header">
          <h2>Filter this month’s whales</h2>
          <div class="status">
            <span class="status-dot" id="tpStatusDot"></span>
            <span id="tpStatusText">Loading live data from LADBS…</span>
          </div>
        </div>

        <div class="filters">
          <div>
            <label for="tpTrade">Trade</label>
            <select id="tpTrade">
              <option value="all">All</option>
              <option value="roof">Roof</option>
              <option value="solar">Solar</option>
              <option value="adu">ADU</option>
              <option value="hvac">HVAC</option>
              <option value="panel">Panel upgrade</option>
            </select>
          </div>
          <div>
            <label for="tpDays">Days back</label>
            <select id="tpDays">
              <option value="7">7</option>
              <option value="14">14</option>
              <option value="30" selected>30</option>
              <option value="60">60</option>
            </select>
          </div>
          <div>
            <label for="tpMin">Min value</label>
            <select id="tpMin">
              <option value="0">$0+</option>
              <option value="25000">$25k+</option>
              <option value="50000">$50k+</option>
              <option value="100000">$100k+</option>
              <option value="250000">$250k+</option>
            </select>
          </div>
          <div style="display:flex;align-items:flex-end;justify-content:flex-end;">
            <button class="btn-primary" id="tpRefresh">Refresh</button>
          </div>
        </div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Issued</th>
                <th>Address</th>
                <th>Value</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody id="tpBody">
              <tr><td colspan="4" class="muted">Loading…</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- SIDE CARD -->
      <aside class="side-card">
        <div class="side-badge">Free preview</div>
        <div class="side-title">Want this pushed to you?</div>
        <p class="muted">
          I can send a weekly Top Permits digest for your trade + ZIP codes in English or Spanish.
        </p>
        <ul class="side-list">
          <li>CSV + call-ready list.</li>
          <li>1–2 high-value jobs highlighted.</li>
          <li>No logins, no spam.</li>
        </ul>
        <p class="muted" style="margin-top:10px;">
          Email <a href="mailto:hello@getpermitpulse.com?subject=Top%20Permits%20Digest">hello@getpermitpulse.com</a> with your trade + target areas and I’ll send a sample.
        </p>
      </aside>
    </div>

    <footer>
      <div>© 2025 PermitPulse. Built in Los Angeles.</div>
    </footer>
  </main>

 <script>
(function () {
  const DATASET_URL = 'https://data.lacity.org/resource/pi9x-tg5x.json';

  const TRADE_KEYWORDS = {
    roof:  ['REROOF', 'ROOF'],
    solar: ['SOLAR'],
    adu:   ['ADU'],
    hvac:  ['HVAC'],
    panel: ['PANEL UPGRADE', 'SERVICE UPGRADE'],
    all:   []
  };

  const els = {
    trade: document.getElementById('tpTrade'),
    days: document.getElementById('tpDays'),
    min: document.getElementById('tpMin'),
    refresh: document.getElementById('tpRefresh'),
    body: document.getElementById('tpBody'),
    statusText: document.getElementById('tpStatusText'),
    statusDot: document.getElementById('tpStatusDot')
  };

  function formatSoqlDate(daysBack) {
    const d = new Date();
    d.setDate(d.getDate() - daysBack);
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    return y + '-' + m + '-' + day + 'T00:00:00';
  }

  function firstField(row, keys) {
    for (var i = 0; i < keys.length; i++) {
      var key = keys[i];
      if (row[key]) return row[key];
      var lower = key.toLowerCase();
      if (row[lower]) return row[lower];
      var upper = key.toUpperCase();
      if (row[upper]) return row[upper];
    }
    return '';
  }

  function formatCurrency(val) {
    var num = Number(val);
    if (!isFinite(num)) return '—';
    if (num >= 1000000) {
      return '$' + (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
    }
    if (num >= 1000) {
      return '$' + (num / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
    }
    return '$' + num.toLocaleString('en-US', { maximumFractionDigits: 0 });
  }

  function setStatus(online) {
    if (!els.statusDot || !els.statusText) return;
    if (online) {
      els.statusDot.style.background = '#22c55e';
      els.statusText.textContent = 'Online · live data from LADBS';
    } else {
      els.statusDot.style.background = '#f97373';
      els.statusText.textContent = 'Temporarily offline · showing sample data';
    }
  }

  function renderRows(rows) {
    if (!els.body) return;
    els.body.innerHTML = '';

    if (!rows || !rows.length) {
      var trEmpty = document.createElement('tr');
      trEmpty.innerHTML = '<td colspan="4" class="muted">No permits match this filter.</td>';
      els.body.appendChild(trEmpty);
      return;
    }

    rows.forEach(function (row) {
      var issueRaw = firstField(row, ['issue_date']);
      var issue = issueRaw ? String(issueRaw).slice(0, 10) : '—';

      var valRaw = firstField(row, ['valuation', 'est_valuation']);
      var val = formatCurrency(valRaw);

      var addr = firstField(row, ['address', 'site_addr', 'site_address', 'location_address']);
      if (!addr) {
        var num = firstField(row, ['addr_start', 'addr_number', 'house_no']);
        var street = firstField(row, ['street_name']);
        var suffix = firstField(row, ['street_suffix']);
        addr = [num, street, suffix].filter(Boolean).join(' ');
      }
      var city = firstField(row, ['city', 'city_name']);
      var zip = firstField(row, ['zip', 'zip_code']);
      var fullAddr = [addr, city, zip].filter(Boolean).join(', ') || '—';

      var desc = firstField(row, ['work_desc', 'description']) || '—';

      var tr = document.createElement('tr');
      tr.innerHTML =
        '<td>' + issue + '</td>' +
        '<td>' + fullAddr + '</td>' +
        '<td class="val">' + val + '</td>' +
        '<td>' + desc + '</td>';
      els.body.appendChild(tr);
    });
  }

  var SAMPLE = [
    {
      issue_date: '2025-11-20T00:00:00',
      address: '8100 SUNSET BLVD, LOS ANGELES, CA 90046',
      valuation: 550000,
      work_desc: 'TI FOR NEW RESTAURANT SPACE. STRUCTURAL + MEP.'
    },
    {
      issue_date: '2025-11-18T00:00:00',
      address: '1200 S FIGUEROA ST, LOS ANGELES, CA 90015',
      valuation: 980000,
      work_desc: 'NEW ROOF + SOLAR + STRUCTURAL UPGRADE FOR EXISTING COMMERCIAL BUILDING.'
    }
  ];

  async function loadTopPermits() {
    if (!els.body) return;
    els.body.innerHTML = '<tr><td colspan="4" class="muted">Loading…</td></tr>';

    var tradeValue = (els.trade.value || 'all').toLowerCase();
    var daysBack = parseInt(els.days.value || '30', 10);
    var minVal = parseInt(els.min.value || '0', 10);

    var params = new URLSearchParams();
    params.set('$limit', '100');
    params.set('$order', 'valuation DESC');

    var whereParts = [
      "issue_date >= '" + formatSoqlDate(daysBack) + "'"
    ];

    if (minVal > 0) {
      whereParts.push('valuation >= ' + minVal);
    }

    var keywords = TRADE_KEYWORDS[tradeValue] || [];
    if (keywords.length) {
      var clauses = keywords.map(function (k) {
        var safe = k.replace(/'/g, "''").toUpperCase();
        return "upper(work_desc) like '%" + safe + "%'";
      });
      whereParts.push('(' + clauses.join(' OR ') + ')');
    }

    params.set('$where', whereParts.join(' AND '));

    try {
      const res = await fetch(DATASET_URL + '?' + params.toString());
      if (!res.ok) throw new Error('Network');
      const data = await res.json();
      renderRows(data);
      setStatus(true);
    } catch (err) {
      console.error('Top Permits error', err);
      renderRows(SAMPLE);
      setStatus(false);
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    if (els.refresh) {
      els.refresh.addEventListener('click', loadTopPermits);
    }
    loadTopPermits();
  });
})();
        </script>
</body>
</html>
